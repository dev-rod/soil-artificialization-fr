<VirtualHost *:80>
        ServerName domain.tld

        RewriteEngine On
        RewriteCond %{SERVER_NAME} =domain.tld
        RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<VirtualHost *:443>
        ServerName domain.tld

        # golem use shiny proxy so
        RewriteEngine on
        RewriteCond %{HTTP:Upgrade} =websocket
        RewriteRule /(.*) ws://localhost:8081/$1 [P,L]
        RewriteCond %{HTTP:Upgrade} !=websocket
        RewriteRule /(.*) http://localhost:8081/$1 [P,L]

        ProxyPass / http://localhost:8081/
        ProxyPassReverse / http://localhost:8081/

        ErrorLog ${APACHE_LOG_DIR}/error_soil-artificialization_ssl.log
        CustomLog ${APACHE_LOG_DIR}/access_soil-artificialization_ssl.log combined

        LogLevel info ssl:warn

        <FilesMatch "\.(cgi|shtml|phtml|php)$">
                SSLOptions +StdEnvVars
        </FilesMatch>
        <Directory /usr/lib/cgi-bin>
                SSLOptions +StdEnvVars
        </Directory>

        SSLCertificateFile /etc/letsencrypt/live/domain.tld/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/domain.tld/privkey.pem
        Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
